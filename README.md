# –ó–∞–¥–∞–Ω–∏–µ 3
–ú–µ—Ä–∑–ª—è–∫–æ–≤ –ò–ª—å—è, –≥—Ä—É–ø–ø–∞ 20213

## 1. –ì–¥–µ —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω –∫–æ–¥ –º–æ–¥–µ–ª–∏, –∫—Ç–æ —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫
–†–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫ –º–æ–¥–µ–ª–∏ - –°–±–µ—Ä–±–∞–Ω–∫, –∫–æ–¥ —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω –Ω–∞ [–ì–∏—Ç—Ö–∞–±–µ](https://github.com/ai-forever/ghost)
# 2. –°—Ç–∞—Ç—å—è
–£ –∞–≤—Ç–æ—Ä–æ–≤ –µ—Å—Ç—å [–ø—É–±–ª–∏–∫–∞—Ü–∏—è](https://ieeexplore.ieee.org/abstract/document/9851423) –∏ [—Å—Ç–∞—Ç—å—è –Ω–∞ —Ö–∞–±—Ä–µ](https://habr.com/ru/companies/sberbank/articles/645919/).

## –°—É—Ç—å –ø–æ–¥—Ö–æ–¥–∞ –∞–≤—Ç–æ—Ä–æ–≤
–°—É—Ç—å –ø–æ–¥—Ö–æ–¥–∞ –∞–≤—Ç–æ—Ä–æ–≤ - –≤–∑—è—Ç—å —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –º–æ–¥–µ–ª–∏ –∏ —É–ª—É—á—à–∏—Ç—å –∏—Ö.  
–û—Å–Ω–æ–≤–Ω—ã–µ —à–∞–≥–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è:
1. –ù–∞–π—Ç–∏ –∏ –≤—ã—Ä–µ–∑–∞—Ç—å –ª–∏—Ü–∞ —Å  source (–ª–∏—Ü–æ, –∫–æ—Ç–æ—Ä–æ–µ –±—É–¥–µ–º –≤—Å—Ç–∞–≤–ª—è—Ç—å)(Xs) –∏ target (–∫–∞—Ä—Ç–∏–Ω–∫–∞/–≤–∏–¥–µ–æ, –∫—É–¥–∞ –≤—Å—Ç–∞–≤–ª—è–µ–º)(Xt) –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π.
3. –° –ø–æ–º–æ—â—å—é –º–æ–¥–µ–ª–∏ ArcFace –∏–∑–≤–ª–µ—á—å –∏–∑ Xs identity –ø—Ä–∏–∑–Ω–∞–∫–∏ (—á–µ—Ä—Ç—ã –ª–∏—Ü–∞)
3. –° –ø–æ–º–æ—â—å—é –¥—Ä—É–≥–æ–π –º–æ–¥–µ–ª–∏ –∏–∑–≤–ª–µ—á—å –∏–∑ Xt –∞—Ç—Ä–∏–±—É—Ç–∏–≤–Ω—ã–µ –ø—Ä–∏–∑–Ω–∞–∫–∏
7. –°–º–µ—à–∞—Ç—å –∞—Ç—Ä–∏–±—É—Ç–∏–≤–Ω—ã–µ –∏ identity –≤–µ–∫—Ç–æ—Ä–∞ –ø—Ä–∏–∑–Ω–∞–∫–æ–≤
2. –ü–æ–ª—É—á–∏—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ —á–µ–ª–æ–≤–µ–∫–∞, –∫–æ—Ç–æ—Ä–æ–µ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç identity –∏–∑ source –∏ –∞—Ç—Ä–∏–±—É—Ç—ã –∏–∑ destination
7. –í—Å—Ç–∞–≤–∏—Ç—å –ø–æ–ª—É—á–µ–Ω–Ω–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤ target

## –û–±—É—á–µ–Ω–∏–µ
–ú–æ–¥–µ–ª—å –±—ã–ª–∞ –æ–±—É—á–µ–Ω–∞ –Ω–∞ –¥–∞—Ç–∞—Å–µ—Ç–µ VGGFace2, –∏–∑ –∫–æ—Ç–æ—Ä–æ–≥–æ —É–±—Ä–∞–ª–∏ –≤—Å–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è –º–µ–Ω–µ–µ 256x256. –ú–æ–¥–µ–ª—å –æ–±—É—á–∞–ª–∞—Å—å –≤ 2 —ç—Ç–∞–ø–∞, –Ω–∞ –ø–µ—Ä–≤–æ–º –Ω–µ —É—á–∏—Ç—ã–≤–∞–ª–∞—Å—å —Ñ—É–Ω–∫—Ü–∏—è –ø–æ—Ç–µ—Ä—å –≥–ª–∞–∑, –Ω–∞ –≤—Ç–æ—Ä–æ–º –Ω–∞–æ–±–æ—Ä–æ—Ç, —É—á–∏—Ç—ã–≤–∞–ª–∞—Å—å —Å –±–æ–ª—å—à–∏–º –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç–æ–º. –ú–æ–¥–µ–ª—å —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∞–ª–∞—Å—å 12 —ç–ø–æ—Ö.

## –ú–µ—Ç—Ä–∏–∫–∏
| method             | ID retrieval | shape_ringnet | exp_ringnet | pose_ringnet | poseHN  | eye_ldmk |
|--------------------|--------------|---------------|-------------|--------------|---------|----------|
| FaceSwap (2017)    | 58.82        | 0.75          | 0.305 üí•    | 0.045        | 1.94    | 4.22     |
| DeepFakes (2018)   | 72.42        | 0.65          | 0.696       | 0.110        | 7.35    | 11.6     |
| FaceShifter (2019) | 82.02        | 0.67          | 0.420       | 0.040        | 1.93 üí• | 2.48     |
| SimSwap (2021)     | 87.42        | 0.72          | 0.340       | 0.035 üí•     | 2.13    | 2.91     |
| HifiFace (2021)    | 89.17        | 0.64 üí•       | 0.510       | 0.048        | 2.13    | 2.04     |
| **Ghost üí•**       | 90.61 üí•     | 0.64 üí•       | 0.436       | 0.047        | 2.26    | 2.02 üí•  |

# 3. –ß–∞—Å—Ç–∏ –º–æ–¥–µ–ª–∏
–ú–æ–¥–µ–ª—å —Å–æ—Å—Ç–æ–∏—Ç –∏–∑ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —á–∞—Å—Ç–µ–π:
* insightface - –≤—ã—Ä–µ–∑–∫–∞ –ª–∏—Ü –∏–∑ –∫–∞—Ä—Ç–∏–Ω–æ–∫
* AEI_Net - –æ—Å–Ω–æ–≤–Ω–∞—è –º–æ–¥–µ–ª—å
* netArc - arcface –º–æ–¥–µ–ª—å –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤ –ª–∏—Ü
* handler - –º–æ–¥–µ–ª—å –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏–µ face landmark'–æ–≤ (—Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏—è –∫–ª—é—á–µ–≤—ã—Ö —Ç–æ—á–µ–∫ –Ω–∞ –ª–∏—Ü–µ)
* pix2pix - –º–æ–¥–µ–ª—å –¥–ª—è —É–≤–µ–ª–∏—á–µ–Ω–∏—è —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è –≤—ã—Ö–æ–¥–Ω–æ–≥–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

# 4. –ò–Ω—Ñ–µ—Ä–µ–Ω—Å
–ò–Ω—Ñ–µ—Ä–µ–Ω—Å –¥–ª—è –≤–∏–¥–µ–æ, –Ω–∞—Å–∫–æ–ª—å–∫–æ —è –ø–æ–Ω—è–ª, –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç—Å—è –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∫–∞–¥—Ä–∞ –æ—Ç–¥–µ–ª—å–Ω–æ –∫–∞–∫ –¥–ª—è —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏.
1. –í —Ñ—É–Ω–∫—Ü–∏—é ```model_inference``` –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è –Ω–µ–æ–±—Ä–µ–∑–∞–Ω–Ω—ã–µ –∫–∞–¥—Ä—ã, –∫—É–¥–∞ –Ω—É–∂–Ω–æ –≤—Å—Ç–∞–≤–∏—Ç—å –ª–∏—Ü–æ, –æ–±—Ä–µ–∑–∞–Ω–Ω–æ–µ –∏ –≤—ã—Ä–∞–≤–Ω–µ–Ω–Ω–æ–µ –∞—Ñ—Ñ–∏–Ω–Ω—ã–º –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ–º –ª–∏—Ü–æ-–∏—Å—Ç–æ—á–Ω–∏–∫, –∞ —Ç–∞–∫–∂–µ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) –≤—ã—Ä–∞–≤–Ω–µ–Ω–Ω–æ–π –ª–∏—Ü–æ, –∫–æ—Ç–æ—Ä–æ–µ –Ω—É–∂–Ω–æ –∑–∞–º–µ–Ω—è—Ç—å (–¥–ª—è —Å–ª—É—á–∞—è, –µ—Å–ª–∏ –≤ —Ç–∞—Ä–≥–µ—Ç–µ –Ω–µ—Å–∫–æ–ª—å–∫–æ –ª—é–¥–µ–π)
1. –ò–∑ —Ç–∞—Ä–≥–µ—Ç —Ñ—Ä–µ–π–º–æ–≤ –≤—ã—Ä–µ–∑–∞—é—Ç—Å—è –∏ –≤—ã—Ä–∞–≤–Ω–∏–≤–∞—é—Ç—Å—è –ª–∏—Ü–∞, –ø–æ—Ö–æ–∂–∏–µ –Ω–∞ —É–∫–∞–∑–∞–Ω–Ω–æ–µ (–∏–ª–∏ –ø–µ—Ä–≤–æ–µ –ø–æ–ø–∞–≤—à–µ–µ—Å—è), –≤—Å–µ –æ–±—Ä–µ–∑–∞–Ω–Ω—ã–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –æ–±—Ä–µ–∑–∞—é—Ç—Å—è –¥–æ 224—Ö224, –Ω–æ—Ä–º–∞–ª–∏–∑—É—é—Ç—Å—è –∏ —É–º–µ–Ω—å—à–∞—é—Ç—Å—è –≤ 2 —Ä–∞–∑–∞
1. –õ–∏—Ü–∞ –∫–æ—Ä–º—è—Ç—Å—è –º–æ–¥–µ–ª–∏
1. –í —Ä–µ–∑—É–ª—å—Ç–∞—Ç–µ –ø–æ–ª—É—á–∞–µ—Ç—Å—è —Ç–∞–∫–æ–µ –∂–µ –æ–±—Ä–µ–∑–∞–Ω–Ω–æ–µ –ª–∏—Ü–æ, –∫–æ—Ç–æ—Ä–æ–µ –ø—Ä–æ—Ö–æ–¥–∏—Ç –æ–±—Ä–∞—Ç–Ω—ã–µ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è
1. (–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) —Ä–µ–∑—É–ª—å—Ç–∞—Ç —É–≤–µ–ª–∏—á–∏–≤–∞—é—Ç –≤ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–∏ –¥—Ä—É–≥–æ–π –º–æ–¥–µ–ª—å—é
1. –†–µ–∑—É–ª—å—Ç–∞—Ç –Ω–∞–∫–ª–∞–¥—ã–≤–∞–µ—Ç—Å—è –Ω–∞ —Ü–µ–ª–µ–≤–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ø–æ –ø–æ–ª—É–ø—Ä–æ–∑—Ä–∞—á–Ω–æ–π –º–∞—Å–∫–µ (–æ–Ω–∞ –ø–æ—Å—Ç—Ä–æ–µ–Ω–∞ –Ω–∞ –ø–æ–ª–æ–∂–µ–Ω–∏–∏ –Ω–∞–π–¥–µ–Ω–Ω—ã—Ö —Ä–∞–Ω–µ–µ –æ—Å–Ω–æ–≤–Ω—ã—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤ –ª–∏—Ü–∞)
1. (–î–ª—è –≤–∏–¥–µ–æ) –∫–∞—Ä—Ç–∏–Ω–∫–∏ —Å–∫–ª–µ–∏–≤–∞—é—Ç—Å—è –≤ –≤–∏–¥–µ–æ, –≤ –Ω–µ–≥–æ –∫–æ–ø–∏—Ä—É–µ—Ç—Å—è –∑–≤—É–∫ –∏—Å—Ö–æ–¥–Ω–æ–≥–æ –≤–∏–¥–µ–æ

# 5. –î–æ–æ–±—É—á–µ–Ω–∏–µ
–î–∞, –º–æ–¥–µ–ª—å –º–æ–∂–Ω–æ –¥–æ–æ–±—É—á–∏—Ç—å, –¥–ª—è —ç—Ç–æ–≥–æ —Ç—Ä–µ–±—É–µ—Ç—Å—è –¥–∞—Ç–∞—Å–µ—Ç VGGFace2.
–î–∞, –∞–≤—Ç–æ—Ä—ã –¥–∞–≤–∞–ª–∏ —Å–æ–≤–µ—Ç—ã –ø–æ –¥–æ–æ–±—É—á–µ–Ω–∏—é:
* –ú–µ–Ω—è—Ç—å –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç—ã —Ñ—É–Ω–∫—Ü–∏–π –ø–æ—Ç–µ—Ä—å –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è, –Ω–∞ –∫–∞–∫–æ–µ –∏–∑ –¥–≤—É—Ö –≤—Ö–æ–¥–Ω—ã—Ö –ª–∏—Ü –±—É–¥–µ—Ç –ø–æ—Ö–æ–∂–µ –ª–∏—Ü–æ –≤ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–µ

# 6. –ú–æ–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
–Ø –Ω–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª –Ω–æ—É—Ç–±—É–∫ –∏ –∫–æ–ª–ª–∞–±, –∞ –∑–∞–ø—É—Å–∫–∞–ª –º–æ–¥–µ–ª—å –ª–æ–∫–∞–ª—å–Ω–æ —Å –ø–æ–º–æ—â—å—é ```inference.py```. –ù–µ–æ–±—Ö–æ–¥–∏–º–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ –º–æ–∂–Ω–æ –ø–æ–ª—É—á–∏—Ç—å –≤ –¥–æ–∫–µ—Ä–µ (Dockerfile –ø—Ä–∏–ª–∞–≥–∞–µ—Ç—Å—è).

* Source: ![](source.jpg)
## –§–æ—Ç–æ:
* Target: ![](image_target.jpg)
* Result: ![](image_result.jpg)
## –í–∏–¥–µ–æ
–ü—Ä–∏—à–ª–æ—Å—å —É–º–µ–Ω—å—à–∏—Ç—å batch size –¥–æ 10 (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 40), –∞ —Ç–æ –Ω–µ —Ö–≤–∞—Ç–∞–ª–æ –≤–∏–¥–µ–æ–ø–∞–º—è—Ç–∏ (10 GB)
* Target: ![](video_target.gif)
* Result: ![](video_result.gif)